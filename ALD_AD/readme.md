# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π –º–µ–∂–¥—É ALD Pro –∏ Active Directory

> **–í–∞–∂–Ω–æ:** –î–ª—è –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–µ–≥–æ –¥–æ–≤–µ—Ä–∏—è —Ç—Ä–µ–±—É–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –ø–∞–∫–µ—Ç `aldpro-server-trust-ad` –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ç–µ–≤–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

---

## üìã –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ |
|----------|------------|
| **–í—Ä–µ–º—è** | –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É —Å–µ—Ä–≤–µ—Ä–∞–º–∏ (< 5 –º–∏–Ω—É—Ç —Ä–∞–∑–Ω–∏—Ü—ã) |
| **–°–µ—Ç–µ–≤–∞—è —Å–≤—è–∑–Ω–æ—Å—Ç—å** | –û—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ—Ä—Ç—ã: 53 (DNS), 88 (Kerberos), 389 (LDAP), 445 (SMB) |
| **DNS** | –í–∑–∞–∏–º–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∏–º—ë–Ω –º–µ–∂–¥—É –¥–æ–º–µ–Ω–∞–º–∏ |
| **–£—á—ë—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å** | –ü—Ä–∞–≤–∞ **Domain Admin** –≤ –¥–æ–º–µ–Ω–µ Active Directory |

---

## üîß –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É—Å–ª–æ–≤–Ω–æ–≥–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ Windows

–í—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–∞ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ –¥–æ–º–µ–Ω–∞ Windows (**PowerShell –æ—Ç –∏–º–µ–Ω–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞**):

```powershell
# –°–æ–∑–¥–∞—Ç—å –∑–æ–Ω—É —É—Å–ª–æ–≤–Ω–æ–≥–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –¥–æ–º–µ–Ω–∞ ALD Pro
Add-DnsServerConditionalForwarderZone `
  -Name "aldpro.lab" `
  -ReplicationScope "Forest" `
  -MasterServers "172.21.30.2"  # ‚Üê IP-–∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ gs-alddc01
```

> üí° **–ü—Ä–æ–≤–µ—Ä–∫–∞:**  
> ```powershell
> nslookup _ldap._tcp.aldpro.lab
> nslookup _kerberos._tcp.aldpro.lab
> ```

---

## üîß –®–∞–≥ 2: –û—Ç–∫–ª—é—á–µ–Ω–∏–µ DNSSEC –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ ALD Pro

```bash
# –û—Ç–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É DNSSEC (—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å –≤–Ω–µ—à–Ω–∏–º–∏ –¥–æ–º–µ–Ω–∞–º–∏)
sudo sed -i "s/dnssec-validation.*\$/dnssec-validation no;/g" /etc/bind/ipa-options-ext.conf

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–ª—É–∂–±—ã
sudo ipactl restart
```

---

## üîß –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ø–µ—Ä–µ—Å—ã–ª–∫–∏ –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ ALD Pro

1. –û—Ç–∫—Ä—ã—Ç—å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å: `https://gs-alddc01.aldpro.lab`
2. –ü–µ—Ä–µ–π—Ç–∏: **Network Services ‚Üí DNS ‚Üí Forward Zones**
3. –ù–∞–∂–∞—Ç—å **¬´Add¬ª** –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å:
   - **Zone name:** `windows.lab` (–∏–º—è –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞ AD)
   - **Forwarders:** IP-–∞–¥—Ä–µ—Å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –¥–æ–º–µ–Ω–∞ Windows (–Ω–∞–ø—Ä–∏–º–µ—Ä, `172.21.31.10`)
   - **Forward policy:** `Only forward` (—Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ—Å—ã–ª–∞—Ç—å)
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è

---

## üîß –®–∞–≥ 4: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ AD Trust

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞–∫–µ—Ç (–µ—Å–ª–∏ –µ—â—ë –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
sudo apt update
sudo apt install aldpro-server-trust-ad

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É –¥–æ–≤–µ—Ä–∏—è
sudo ipa-adtrust-install --add-sids --enable-compat

# –ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è ‚Äî –æ—Ç–≤–µ—á–∞—Ç—å ¬´yes¬ª –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã
```

> ‚ö†Ô∏è **–í–∞–∂–Ω–æ:**  
> - –£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ **NetBIOS-–∏–º—è** –¥–æ–º–µ–Ω–∞ (–º–∞–∫—Å. 15 —Å–∏–º–≤–æ–ª–æ–≤, –±–µ–∑ —Ç–æ—á–∫–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä `ALDPRO`)  
> - –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–ª—É–∂–±—ã `smb` –∏ `winbind` –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ —Å—Ç–∞—Ç—É—Å–µ **active (running)**

---

## üîß –®–∞–≥ 5: –°–æ–∑–¥–∞–Ω–∏–µ –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–µ–≥–æ –¥–æ–≤–µ—Ä–∏—è

```bash
# –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –≤ IPA
kinit admin

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–≤–µ—Ä–∏—è (–≤–≤–æ–¥ –ø–∞—Ä–æ–ª—è –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—à–µ–Ω –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ)
ipa trust-add \
  --type=ad \
  windows.lab \                  # ‚Üê –∏–º—è –¥–æ–º–µ–Ω–∞ AD
  --admin Administrator \        # ‚Üê —É—á—ë—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å —Å –ø—Ä–∞–≤–∞–º–∏ Domain Admin
  --password \
  --two-way=true
```

> üí° **–ü–æ–¥—Å–∫–∞–∑–∫–∏:**  
> - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–º—è `Administrator` (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —É—á—ë—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å –¥–æ–º–µ–Ω–∞)  
> - –ü–∞—Ä–æ–ª—å –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø—Ä–∏ –≤–≤–æ–¥–µ ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ  
> - –î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –¥–æ–±–∞–≤—å—Ç–µ —Ñ–ª–∞–≥–∏ `-d -v`

---

## üîç –®–∞–≥ 6: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –¥–æ–≤–µ—Ä–∏–π
ipa trust-find

# –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ–≤–µ—Ä–∏–∏
ipa trust-show windows.lab --all

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –¥–æ–º–µ–Ω–∞ AD
ipa user-find --domain=windows.lab

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã Winbind
wbinfo --ping-dc
wbinfo -u  # —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ–≥–æ –¥–æ–º–µ–Ω–∞
```

---

## üö® –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

| –ü—Ä–æ–±–ª–µ–º–∞ | –†–µ—à–µ–Ω–∏–µ |
|----------|---------|
| `–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –ø–∞–∫–µ—Ç ipa-adtrust-install` | –≠—Ç–æ **–∫–æ–º–∞–Ω–¥–∞**, –∞ –Ω–µ –ø–∞–∫–µ—Ç. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `aldpro-server-trust-ad` |
| `Logon failure` –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –¥–æ–≤–µ—Ä–∏—è | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–º—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (`Administrator`, –Ω–µ `admin`) –∏ –ø–∞—Ä–æ–ª—å |
| –ó–∞–ø–∏—Å–∏ SRV –Ω–µ —Ä–∞–∑—Ä–µ—à–∞—é—Ç—Å—è —Å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ Windows | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å–ª–æ–≤–Ω–æ–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–ª—É–∂–±—É `DNS` –Ω–∞ DC |
| –ü–æ—Ä—Ç 445 –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω | –û—Ç–∫—Ä–æ–π—Ç–µ –ø–æ—Ä—Ç –≤ —Ñ–∞–µ—Ä–≤–æ–ª–µ –º–µ–∂–¥—É —Å–µ—Ä–≤–µ—Ä–∞–º–∏ |
| –û—à–∏–±–∫–∞ `dnssec-validation` | –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å—Ç—Ä–æ–∫–∞ –∑–∞–º–µ–Ω–µ–Ω–∞ –≤ `/etc/bind/ipa-options-ext.conf` –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ `ipactl restart` |

---

## üìå –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω —É—Å–ª–æ–≤–Ω—ã–π –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç–µ–ª—å –Ω–∞ DNS Windows –¥–ª—è `aldpro.lab`
- [ ] –û—Ç–∫–ª—é—á—ë–Ω `dnssec-validation` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ ALD Pro
- [ ] –°–æ–∑–¥–∞–Ω–∞ –∑–æ–Ω–∞ –ø–µ—Ä–µ—Å—ã–ª–∫–∏ –¥–ª—è `windows.lab` –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ ALD Pro
- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω `ipa-adtrust-install`
- [ ] –°–ª—É–∂–±—ã `smb` –∏ `winbind` —Ä–∞–±–æ—Ç–∞—é—Ç (`systemctl status smb winbind`)
- [ ] –í—Ä–µ–º—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –º–µ–∂–¥—É —Å–µ—Ä–≤–µ—Ä–∞–º–∏
- [ ] –ü–æ—Ä—Ç 445 –æ—Ç–∫—Ä—ã—Ç –æ—Ç Windows –∫ ALD Pro

---

## üí° –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

```bash
# –õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –∫–∞—Ç–∞–ª–æ–≥–æ–≤
sudo tail -f /var/log/dirsrv/slapd-ALDPRO-LAB/errors | grep -i trust

# –°—Ç–∞—Ç—É—Å —Å–ª—É–∂–±
systemctl status smb winbind dirsrv named

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤–æ–π —Å–≤—è–∑–Ω–æ—Å—Ç–∏
nc -zv <DC_IP> 445  # —Å —Å–µ—Ä–≤–µ—Ä–∞ ALD Pro
Test-NetConnection <ALD_IP> -Port 445  # —Å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ Windows
```

---

> ‚úÖ **–ì–æ—Ç–æ–≤–æ!** –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏–∑ –¥–æ–º–µ–Ω–∞ `windows.lab` —Å–º–æ–≥—É—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ —Ä–µ—Å—É—Ä—Å–∞—Ö ALD Pro, –∞ –ø—Ä–∏ –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–µ–º –¥–æ–≤–µ—Ä–∏–∏ ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ `aldpro.lab` –ø–æ–ª—É—á–∞—Ç –¥–æ—Å—Ç—É–ø –∫ —Ä–µ—Å—É—Ä—Å–∞–º –¥–æ–º–µ–Ω–∞ Windows.
