# Общая инструкция по развертыванию лаборатории 
---

## 1) Сервер подключения (Wireguard)

**Роль:** входной сервер для участников лаборатории, точка доступа/туннелирования.

**ОС и доступ:**
- ОС: Ubuntu (без графического интерфейса).
- Доступ по SSH; можно оставить стандартный порт (22).
- Создать учётную запись с правами администратора (sudo).
- Рекомендуется настроить SSH-ключи и отключить вход по паролю после настройки (опционально).

**Сетевые интерфейсы:**
- ВМ имеет 6 интерфейсов:
  - `eth0` — «белый» (публичный) IP для внешнего доступа.
  - `eth1`–`eth5` — интерфейсы для подсетей лабораторий (шлюзы).

**Шаблон адресации:** подсети используют формат 172.2X.30.0/24, где X — номер лаборатории (1..5).
- Пример для `eth1` (X=1):
  - IP интерфейса: `172.21.30.254`
  - Маска: `/24` (255.255.255.0)
  - Шлюз (gateway): `172.21.30.253`

> Для `eth2` аналогично: сеть `172.22.30.0/24`, gateway `172.22.30.253` и т.д.

**Дополнительные пакеты (опционально):**
- ca-certificates, curl, gnupg, docker-ce, docker-ce-cli, containerd.io, docker-buildx-plugin, docker-compose-plugin

**Для корректной установки Docker:**
```bash
sudo install -m 0755 -d /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
sudo chmod a+r /etc/apt/keyrings/docker.gpg

echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
  $(. /etc/os-release && echo "$VERSION_CODENAME") stable" | \
  sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

sudo apt update && sudo apt install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin
```

---

## 2) МЭ (pfSense)

**Дистрибутив:** версия 2.7.2 (ссылка для скачивания: https://disk.yandex.ru/d/FuHP2-XtIEHV7A).

**Сетевые интерфейсы (минимум):**
- `WAN` — подключение в интернет (публичный/белый IP). На этом интерфейсе задаётся Default Gateway.
- `LAN` — сеть «Административного блока», пример: `172.2X.30.253` (где X — номер лаборатории).
- `OPT1` — сеть «Производственный комплекс», пример: `172.2X.31.253` (обратите внимание на третий октет — 31).

**Правила и маршрутизация:**
- Базовая конфигурация: правила по умолчанию ANY <-> ANY для всех интерфейсов.
- Дополнительные шлюзы (Gateways) настраивать не требуется, подсети будут знать друг о друге через сам pfSense.

**Учётные данные по умолчанию:**
- Логин: `admin`
- Пароль: `pfsense`

> Изменять дефолтный пароль после первоначальной настройки - не нужно.

---

## 3) Виртуальные машины (VM)

**Общие положения:**
- На схеме указаны имена VM и их IP-адреса; маска подсетей `/24`.
- Шлюз всех VM — соответствующий интерфейс pfSense.
- Разметка дисков: автоматическая разметка подходит для всех VM.

**Образы и учётные данные:**
- Astra Linux: https://disk.yandex.ru/d/RveG0lZnPEb8gg
  - Логин: `astra`
  - Пароль: `xxXX1234`
- Windows 10 Pro: https://disk.yandex.ru/d/Avb_btJ-quWibQ
  - Логин: `windows`
  - Пароль: `xxXX1234`
- Windows Server 2019: https://disk.yandex.ru/d/LgGGBQsImoCywA
  - Логин: `Администратор`
  - Пароль: `xxXX1234`

**Требования к Windows:**
- Отключить брандмауэр (Windows Firewall).
- Отключить автоматические обновления (по заданию/сценарию лаборатории).
- Настроить доступ по RDP и убедиться, что службы RDP работают.

**Требования к Linux:**
- Отключить ufw (если он активен).
- Настроить SSH-доступ.
- Установить `cifs-utils` для доступа к SMB/CIFS-ресурсам (файловый сервер).

---

## 4) Файловый сервер дистрибутивов (DISTRIB)

**Сеть и интерфейсы:**
- Сервер имеет 5 интерфейсов — по одному IP в подсети каждой лаборатории.
- IP-шаблон: `172.2X.30.252/24` с gateway `172.2X.30.253` (где X — номер лаборатории).

**Ресурсы:**
- Общая папка: `DISTRIB`.
- Доступ: только чтение (read-only) для всех, включая гостевой доступ.
- Дистрибутивы для выгрузки: https://disk.yandex.ru/d/lT0awes-7CtpeQ

---

## 5) Опционально

- Синхронизировать время через NTP/chrony для всех хостов.





